{% extends 'admin/base/index.html' %}
{% from 'admin/components/form_section.html' import form_section %}
{% from 'admin/macros/forms.html' import render_form_field, render_field_error %}

{% block title %}Add New Product - {{ super() }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-3xl font-bold text-gray-900">Add New Product</h1>
        <a href="{{ url_for('web.web_admin.products.products') }}" class="btn-secondary">
            <i class="bx bx-arrow-back mr-2"></i>
            Back to Products
        </a>
    </div>

    <form method="POST" action="{{ url_for('web.web_admin.products.add_new_product') }}" enctype="multipart/form-data" id="product-form" class="space-y-6">
        {{ form.csrf_token }}

        {% call form_section("Basic Information", "bx bxs-info-circle") %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                    {{ form.name.label(class="form-label form-label-required") }}
                    {{ form.name(class="form-input", placeholder="Enter product name") }}
                    {% if form.name.errors %}
                        {% for error in form.name.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    {% if form.name.description %}
                        <p class="form-help">{{ form.name.description }}</p>
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.sku.label(class="form-label") }}
                    {{ form.sku(class="form-input", placeholder="Leave blank to auto-generate") }}
                    {% if form.sku.errors %}
                        {% for error in form.sku.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    {% if form.sku.description %}
                        <p class="form-help">{{ form.sku.description }}</p>
                    {% endif %}
                </div>

                <div class="form-group md:col-span-2">
                    {{ form.slug.label(class="form-label") }}
                    {{ form.slug(class="form-input", placeholder="URL-friendly identifier") }}
                    {% if form.slug.errors %}
                        {% for error in form.slug.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    {% if form.slug.description %}
                        <p class="form-help">{{ form.slug.description }}</p>
                    {% endif %}
                </div>

                <div class="form-group md:col-span-2">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-textarea", rows="4", placeholder="Product description") }}
                    {% if form.description.errors %}
                        {% for error in form.description.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        {% endcall %}

        {% call form_section("Category & Status", "bx bxs-category") %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                    {{ form.category_id.label(class="form-label form-label-required") }}
                    {{ form.category_id(class="form-select") }}
                    {% if form.category_id.errors %}
                        {% for error in form.category_id.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.launch_status.label(class="form-label") }}
                    {{ form.launch_status(class="form-select") }}
                    {% if form.launch_status.errors %}
                        {% for error in form.launch_status.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                {% if category_field %}
                <div class="form-group md:col-span-2">
                    <label class="form-label">Additional Categories (Optional)</label>
                    {{ category_field | safe }}
                </div>
                {% endif %}
            </div>
        {% endcall %}

        {% call form_section("Product Details", "bx bxs-detail", collapsed=True) %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                    {{ form.material.label(class="form-label") }}
                    {{ form.material(class="form-input", placeholder="Product material") }}
                    {% if form.material.errors %}
                        {% for error in form.material.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group md:col-span-2">
                    {{ form.details.label(class="form-label") }}
                    {{ form.details(class="form-textarea", rows="4", placeholder="Additional product details") }}
                    {% if form.details.errors %}
                        {% for error in form.details.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group md:col-span-2">
                    {{ form.care.label(class="form-label") }}
                    {{ form.care(class="form-textarea", rows="4", placeholder="Product care instructions") }}
                    {% if form.care.errors %}
                        {% for error in form.care.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        {% endcall %}

        {% call form_section("SEO Settings", "bx bxs-search-alt-2", collapsed=True) %}
            <div class="grid grid-cols-1 gap-6">
                <div class="form-group">
                    {{ form.meta_title.label(class="form-label") }}
                    {{ form.meta_title(class="form-input", placeholder="SEO meta title") }}
                    {% if form.meta_title.errors %}
                        {% for error in form.meta_title.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.meta_description.label(class="form-label") }}
                    {{ form.meta_description(class="form-textarea", rows="3", placeholder="SEO meta description") }}
                    {% if form.meta_description.errors %}
                        {% for error in form.meta_description.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.meta_keywords.label(class="form-label") }}
                    {{ form.meta_keywords(class="form-input", placeholder="Keywords (comma-separated)") }}
                    {% if form.meta_keywords.errors %}
                        {% for error in form.meta_keywords.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        {% endcall %}

        <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
            <a href="{{ url_for('web.web_admin.products.products') }}" class="btn-secondary">
                Cancel
            </a>
            <button type="submit" class="btn-primary">
                <i class="bx bx-save mr-2"></i>
                Create Product
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Collapsible sections
    document.querySelectorAll('[data-collapse-toggle]').forEach(header => {
        header.addEventListener('click', () => {
            const section = header.closest('.collapsible');
            const body = section.querySelector('.collapsible-body');
            const icon = header.querySelector('[data-collapse-icon]');
            
            section.classList.toggle('collapsed');
            
            if (section.classList.contains('collapsed')) {
                body.style.maxHeight = '0';
                body.style.paddingTop = '0';
                body.style.paddingBottom = '0';
            } else {
                body.style.maxHeight = body.scrollHeight + 'px';
                body.style.paddingTop = '';
                body.style.paddingBottom = '';
            }
            
            if (icon) {
                icon.classList.toggle('rotate-180');
            }
        });
    });
</script>
{% endblock %}

