{% extends 'admin/base/auth_base.html' %}
{% block title %}Signing out... - {{ super() }}{% endblock %}

{% block content %}
<div class="form-wrapper h-full my-auto flex align-center justify-center">
    <div class="card w-full md:w-96 xl:w-4/12 p-6 rounded-lg shadow border bg-white border-gray-200 dark:bg-gray-800 dark:border-gray-700 text-gray-900 dark:text-white min-h-[200px] flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-[#c3622d]/30 border-t-[#c3622d] rounded-full animate-spin mb-4"></div>
        <p class="text-sm text-gray-700 dark:text-gray-300">Signing you out â€” you will be redirected shortly.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    {% if clerk_publishable_key %}
    <script async crossorigin="anonymous" data-clerk-publishable-key="{{ clerk_publishable_key }}" src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
    <script>
        window.addEventListener("load", async () => {
            // Aggressively clear local client storage and cookies
            try {
                Object.keys(localStorage || {}).forEach(k => {
                    if (k.toLowerCase().includes("clerk")) localStorage.removeItem(k);
                });
            } catch (e) {}
            try {
                ["__session", "clerk_session", "__clerk"].forEach(name => {
                    document.cookie = `${name}=; Max-Age=0; path=/;`;
                    document.cookie = `${name}=; Max-Age=0; path=/; domain=${location.hostname};`;
                });
            } catch (e) {}

            try {
                if (!window.Clerk) {
                    await window.Clerk.load();
                }
            } catch (e) {
                // ignore
            }

            try {
                if (window.Clerk && typeof window.Clerk.signOut === "function") {
                    await window.Clerk.signOut();
                }
            } catch (e) {
                // ignore
            } finally {
                window.location.href = "{{ login_url }}";
            }
        });
    </script>
    {% else %}
    <script>
        ["__session", "clerk_session", "__clerk"].forEach(name => {
            document.cookie = `${name}=; Max-Age=0; path=/;`;
            document.cookie = `${name}=; Max-Age=0; path=/; domain=${location.hostname};`;
        });
        window.location.href = "{{ login_url }}";
    </script>
    {% endif %}
{% endblock %}


